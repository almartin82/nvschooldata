---
title: "15 Insights from Nevada School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{15 Insights from Nevada School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  cache = TRUE
)
```

```{r load-packages}
library(nvschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))
```

This vignette explores Nevada's public school enrollment data, surfacing key trends and demographic patterns across 10 years of data (2016-2026).

---

## 1. Nevada's enrollment has plateaued after decades of growth

Nevada was one of America's fastest-growing states for decades, but school enrollment has flattened in recent years. The COVID era marked a turning point.

```{r statewide-trend}
# Note: 2025 data temporarily unavailable from NDE
enr <- fetch_enr_multi(c(2021:2024, 2026), use_cache = TRUE)

state_totals <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  group_by(end_year) |>
  summarize(n_students = sum(n_students, na.rm = TRUE), .groups = "drop") |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 2))

stopifnot(nrow(state_totals) > 0)
state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#003366") +
  geom_point(size = 3, color = "#003366") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Nevada Public School Enrollment (2021-2026)",
    subtitle = "Enrollment has stabilized after years of rapid growth",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 2. Clark County is Nevada's education giant

Clark County School District (Las Vegas metro) is the 5th largest school district in America. Charter networks like Somerset Academy and Pinecrest also rank among the state's largest entities.

```{r top-districts}
enr_2026 <- fetch_enr(2026, use_cache = TRUE)

top_districts <- enr_2026 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students)

stopifnot(nrow(top_districts) > 0)
top_districts
```

```{r top-districts-chart}
top_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = district_name)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_viridis_d(option = "mako", begin = 0.2, end = 0.8) +
  labs(
    title = "Top 10 Nevada Districts by Enrollment (2026)",
    subtitle = "Clark County dominates, followed by Washoe County (Reno)",
    x = "Number of Students",
    y = NULL
  )
```

---

## 3. Nevada's demographic transformation

Hispanic students now represent the largest demographic group in Nevada public schools at 46.5%, reflecting the state's rapid population change.

```{r demographics}
demographics <- enr_2026 |>
  filter(is_district, grade_level == "TOTAL",
         subgroup %in% c("white", "black", "hispanic", "asian", "native_american", "multiracial")) |>
  group_by(subgroup) |>
  summarize(n_students = sum(n_students, na.rm = TRUE), .groups = "drop") |>
  mutate(pct = round(n_students / sum(n_students) * 100, 1)) |>
  arrange(desc(n_students))

stopifnot(nrow(demographics) > 0)
demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Nevada Student Demographics (2026)",
    subtitle = "Hispanic students are now the largest group",
    x = "Number of Students",
    y = NULL
  )
```

---

## 4. Urban vs rural: A tale of two Nevadas

Beyond Las Vegas and Reno, Nevada has dozens of entities classified as districts, including charter schools. The enrollment contrast is stark.

```{r regional}
regional <- enr_2026 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  mutate(region = case_when(
    grepl("Clark", district_name) ~ "Las Vegas Metro",
    grepl("Washoe", district_name) ~ "Reno Metro",
    TRUE ~ "Rural Nevada"
  )) |>
  group_by(region) |>
  summarize(
    n_districts = n_distinct(district_name),
    total_enrollment = sum(n_students, na.rm = TRUE),
    .groups = "drop"
  ) |>
  mutate(pct = round(total_enrollment / sum(total_enrollment) * 100, 1))

stopifnot(nrow(regional) > 0)
regional
```

```{r regional-chart}
regional |>
  mutate(region = factor(region, levels = c("Las Vegas Metro", "Reno Metro", "Rural Nevada"))) |>
  ggplot(aes(x = region, y = total_enrollment, fill = region)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(scales::comma(total_enrollment), "\n(", pct, "%)")),
            vjust = -0.2, size = 4) +
  scale_y_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_manual(values = c("Las Vegas Metro" = "#003366", "Reno Metro" = "#0066CC", "Rural Nevada" = "#66B2FF")) +
  labs(
    title = "Enrollment by Region (2026)",
    subtitle = "Las Vegas dominates Nevada education",
    x = NULL,
    y = "Number of Students"
  )
```

---

## 5. Clark County vs Washoe County: Different trajectories

Clark County (Las Vegas) and Washoe County (Reno) are Nevada's two urban anchors. Clark has lost 8.7% of enrollment since 2021 while Washoe has been more stable, declining only 2.1%.

```{r growth-data}
growth_data <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Clark|Washoe", district_name)) |>
  # Normalize district names (format changed across years)
  mutate(county = case_when(
    grepl("Clark", district_name) ~ "Clark County",
    grepl("Washoe", district_name) ~ "Washoe County"
  )) |>
  group_by(county, end_year) |>
  summarize(n_students = sum(n_students, na.rm = TRUE), .groups = "drop") |>
  group_by(county) |>
  mutate(index = round(n_students / first(n_students) * 100, 1)) |>
  ungroup()

stopifnot(nrow(growth_data) > 0)
growth_data
```

```{r growth-chart}
ggplot(growth_data, aes(x = end_year, y = index, color = county)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  geom_hline(yintercept = 100, linetype = "dashed", color = "gray50") +
  scale_color_manual(values = c("Clark County" = "#BF0A30", "Washoe County" = "#002868")) +
  labs(
    title = "Clark vs Washoe County Enrollment Trends",
    subtitle = "Indexed to 2021 = 100",
    x = "School Year",
    y = "Enrollment Index (2021 = 100)",
    color = "District"
  )
```

---

## 6. Nearly 15% of Nevada students attend charter schools

Nevada's charter sector has grown significantly. Using the package's `is_charter` flag, 51 charter entities enroll over 70,000 students -- nearly 15% of all public school enrollment.

```{r charters}
charter_enr <- enr_2026 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  group_by(is_charter) |>
  summarize(
    students = sum(n_students, na.rm = TRUE),
    districts = n(),
    .groups = "drop"
  ) |>
  mutate(sector = ifelse(is_charter, "Charter (SPCSA)", "Traditional Districts"))

stopifnot(nrow(charter_enr) > 0)
charter_enr |>
  select(sector, students, districts)
```

```{r charter-chart}
charter_enr |>
  ggplot(aes(x = sector, y = students, fill = sector)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = scales::comma(students)), vjust = -0.2, size = 4) +
  scale_y_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_manual(values = c("Charter (SPCSA)" = "#E67300", "Traditional Districts" = "#003366")) +
  labs(
    title = "Traditional vs Charter School Enrollment (2026)",
    subtitle = "Charter schools enroll nearly 15% of Nevada students",
    x = NULL,
    y = "Number of Students"
  )
```

---

## 7. Washoe County: Nevada's second city

Washoe County (Reno-Sparks) is Nevada's second-largest district. While smaller than Clark County, it educates over 60,000 students.

```{r washoe}
washoe_data <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Washoe", district_name)) |>
  group_by(end_year) |>
  summarize(n_students = sum(n_students, na.rm = TRUE), .groups = "drop") |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 2))

stopifnot(nrow(washoe_data) > 0)
washoe_data
```

```{r washoe-chart}
ggplot(washoe_data, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#002868") +
  geom_point(size = 3, color = "#002868") +
  scale_y_continuous(labels = scales::comma, limits = c(0, NA)) +
  labs(
    title = "Washoe County School District Enrollment",
    subtitle = "Reno-Sparks metro area trends",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 8. Grade-level enrollment patterns

Tracking enrollment by grade reveals where schools are growing or shrinking. Grade-level breakdowns are available at the school level; district rows report only totals.

```{r grade-levels}
grade_data <- enr_2026 |>
  filter(is_school, subgroup == "total_enrollment",
         !grade_level %in% c("TOTAL", "UG", "AD")) |>
  group_by(grade_level) |>
  summarize(n_students = sum(n_students, na.rm = TRUE), .groups = "drop") |>
  mutate(grade_level = factor(grade_level, levels = c("PK", "K", sprintf("%02d", 1:12))))

stopifnot(nrow(grade_data) > 0)
grade_data
```

```{r grade-chart}
ggplot(grade_data, aes(x = grade_level, y = n_students, fill = grade_level)) +
  geom_col(show.legend = FALSE) +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_viridis_d(option = "viridis") +
  labs(
    title = "Nevada Enrollment by Grade Level (2026)",
    subtitle = "Distribution across PK-12 grades (school-level aggregation)",
    x = "Grade Level",
    y = "Number of Students"
  )
```

---

## 9. Gender enrollment balance

How does the male/female ratio vary across Nevada? Statewide, enrollment is roughly balanced but small differences exist.

```{r gender}
gender_data <- enr_2026 |>
  filter(is_district, grade_level == "TOTAL",
         subgroup %in% c("male", "female")) |>
  group_by(subgroup) |>
  summarize(n_students = sum(n_students, na.rm = TRUE), .groups = "drop") |>
  mutate(pct = round(n_students / sum(n_students) * 100, 1))

stopifnot(nrow(gender_data) > 0)
gender_data
```

```{r gender-chart}
ggplot(gender_data, aes(x = subgroup, y = n_students, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(scales::comma(n_students), "\n(", pct, "%)")),
            vjust = -0.2, size = 4) +
  scale_y_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_manual(values = c("female" = "#CC3366", "male" = "#336699")) +
  labs(
    title = "Nevada Enrollment by Gender (2026)",
    subtitle = "Statewide male/female distribution",
    x = NULL,
    y = "Number of Students"
  )
```

---

## 10. Special populations across districts

English Learners, students with IEPs, and Free/Reduced Lunch eligible students represent key populations for educational policy. How do the two largest districts compare?

```{r special-populations}
special_pops <- enr_2026 |>
  filter(is_district, grade_level == "TOTAL",
         subgroup %in% c("frl", "iep", "el"),
         grepl("Clark|Washoe", district_name)) |>
  mutate(county = ifelse(grepl("Clark", district_name), "Clark County", "Washoe County")) |>
  group_by(county, subgroup) |>
  summarize(n_students = sum(n_students, na.rm = TRUE), .groups = "drop")

stopifnot(nrow(special_pops) > 0)
special_pops
```

```{r special-pops-chart}
ggplot(special_pops, aes(x = subgroup, y = n_students, fill = county)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = scales::comma(n_students)),
            position = position_dodge(width = 0.9), vjust = -0.2, size = 3) +
  scale_y_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_manual(values = c("Clark County" = "#BF0A30", "Washoe County" = "#002868")) +
  scale_x_discrete(labels = c("el" = "English\nLearners", "frl" = "Free/Reduced\nLunch", "iep" = "Students\nwith IEPs")) +
  labs(
    title = "Special Populations: Clark vs Washoe County (2026)",
    subtitle = "EL, FRL, and IEP student counts",
    x = NULL,
    y = "Number of Students",
    fill = "District"
  )
```

---

## Summary

Nevada's school enrollment data reveals:
- **Clark County dominance**: Over 60% of students are in the Las Vegas metro
- **Demographic shift**: Hispanic students are now the largest demographic group at 46.5%
- **Urban-rural divide**: Rural Nevada has many districts but a fraction of students
- **Charter growth**: 51 charter entities enroll nearly 15% of Nevada students
- **Stabilization**: After decades of growth, enrollment has plateaued

These patterns shape school funding debates and facility planning across the Silver State.

---

## 11. Kindergarten enrollment as a leading indicator

Kindergarten enrollment often predicts future trends. School-level data shows K enrollment dipped to 28,931 in 2024 before recovering to 30,490 in 2026.

```{r kindergarten}
k_data <- enr |>
  filter(is_school, subgroup == "total_enrollment", grade_level == "K") |>
  group_by(end_year) |>
  summarize(k_students = sum(n_students, na.rm = TRUE), .groups = "drop") |>
  mutate(change = k_students - lag(k_students),
         pct_change = round(change / lag(k_students) * 100, 2))

stopifnot(nrow(k_data) > 0)
k_data
```

```{r kindergarten-chart}
ggplot(k_data, aes(x = end_year, y = k_students)) +
  geom_line(linewidth = 1.2, color = "#E67300") +
  geom_point(size = 3, color = "#E67300") +
  scale_y_continuous(labels = scales::comma, limits = c(0, NA)) +
  labs(
    title = "Nevada Kindergarten Enrollment (2021-2026)",
    subtitle = "K enrollment is a leading indicator of future trends",
    x = "School Year (ending)",
    y = "Kindergarten Students"
  )
```

---

## 12. English Learners across Nevada

English Learner (EL) populations vary dramatically across Nevada's districts and charter schools. Clark County has the largest absolute number, but charter schools like Mater Academy have higher EL percentages.

```{r el-district}
el_data <- enr_2026 |>
  filter(is_district, grade_level == "TOTAL", subgroup == "el") |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students, pct)

stopifnot(nrow(el_data) > 0)
el_data
```

```{r el-chart}
el_data |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = pct)) +
  geom_col() +
  geom_text(aes(label = scales::percent(pct, accuracy = 0.1)), hjust = -0.1, size = 3) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.2))) +
  scale_fill_viridis_c(option = "plasma", labels = scales::percent) +
  labs(
    title = "English Learner Enrollment by District (2026)",
    subtitle = "Top 10 districts by EL count; color shows percentage of total enrollment",
    x = "Number of EL Students",
    y = NULL,
    fill = "EL %"
  )
```

---

## 13. Free/Reduced Lunch eligibility reveals economic disparities

FRL eligibility is often used as a proxy for economic disadvantage. Many charter schools report 100% FRL eligibility, while traditional county districts vary widely.

```{r frl}
frl_data <- enr_2026 |>
  filter(is_district, grade_level == "TOTAL", subgroup == "frl") |>
  mutate(pct_display = pct * 100) |>
  arrange(desc(pct)) |>
  head(15) |>
  select(district_name, n_students, pct_display)

stopifnot(nrow(frl_data) > 0)
frl_data
```

```{r frl-chart}
frl_data |>
  mutate(district_name = forcats::fct_reorder(district_name, pct_display)) |>
  ggplot(aes(x = pct_display, y = district_name, fill = pct_display)) +
  geom_col() +
  geom_text(aes(label = paste0(round(pct_display, 1), "%")), hjust = -0.1, size = 3) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.15))) +
  scale_fill_gradient(low = "#66B2FF", high = "#BF0A30", guide = "none") +
  labs(
    title = "Free/Reduced Lunch Eligibility by District (2026)",
    subtitle = "Top 15 districts by FRL percentage",
    x = "Percent FRL Eligible",
    y = NULL
  )
```

---

## 14. Nevada's smallest districts

While Clark County dominates headlines, Nevada has many tiny entities. Charter schools and rural districts alike can have fewer than 200 students.

```{r smallest}
smallest <- enr_2026 |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  arrange(n_students) |>
  head(10) |>
  select(district_name, n_students)

stopifnot(nrow(smallest) > 0)
smallest
```

```{r smallest-chart}
smallest |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name)) +
  geom_col(fill = "#336699") +
  geom_text(aes(label = scales::comma(n_students)), hjust = -0.1, size = 3.5) +
  scale_x_continuous(expand = expansion(mult = c(0, 0.2))) +
  labs(
    title = "Nevada's 10 Smallest Districts (2026)",
    subtitle = "Charter schools and rural counties have the smallest enrollments",
    x = "Total Enrollment",
    y = NULL
  )
```

---

## 15. IEP students: Special education across Nevada

Students with Individualized Education Programs (IEPs) require specialized services. Lyon County leads in IEP rate at 17.0%, while some charter networks have lower rates.

```{r iep}
iep_data <- enr_2026 |>
  filter(is_district, grade_level == "TOTAL", subgroup == "iep") |>
  mutate(pct_display = pct * 100) |>
  arrange(desc(n_students)) |>
  head(10) |>
  select(district_name, n_students, pct_display)

stopifnot(nrow(iep_data) > 0)
iep_data
```

```{r iep-chart}
iep_data |>
  mutate(district_name = forcats::fct_reorder(district_name, n_students)) |>
  ggplot(aes(x = n_students, y = district_name, fill = pct_display)) +
  geom_col() +
  geom_text(aes(label = paste0(round(pct_display, 1), "%")), hjust = -0.1, size = 3) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_viridis_c(option = "cividis") +
  labs(
    title = "Students with IEPs by District (2026)",
    subtitle = "Top 10 districts by IEP count; color shows percentage",
    x = "Number of IEP Students",
    y = NULL,
    fill = "IEP %"
  )
```

---

## Summary

Nevada's school enrollment data reveals:
- **Clark County dominance**: Over 60% of students are in the Las Vegas metro
- **Demographic shift**: Hispanic students are now the largest demographic group at 46.5%
- **Urban-rural divide**: Rural Nevada has many districts but a fraction of students
- **Charter growth**: 51 charter entities enroll nearly 15% of Nevada students
- **Stabilization**: After decades of growth, enrollment has plateaued
- **Economic need**: Many charter schools report 100% FRL, indicating targeted service to high-need populations
- **K enrollment**: Kindergarten numbers signal future enrollment trends

These patterns shape school funding debates and facility planning across the Silver State.

---

*Data sourced from the Nevada Department of Education [Enrollment Data](https://doe.nv.gov/offices/office-of-assessment-data-and-accountability-management-adam/accountability/data-requests/enrollment-for-nevada-public-schools).*

---

## Session Info

```{r session-info}
sessionInfo()
```
